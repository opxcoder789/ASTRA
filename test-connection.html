<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase Connection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #000;
            color: #fff;
        }
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #333;
        }
        .success { border-color: #4CAF50; background: #1a3a1a; }
        .error { border-color: #f44336; background: #3a1a1a; }
        .info { border-color: #2196F3; background: #1a2a3a; }
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #ff8555; }
        pre {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîå Supabase Connection Test</h1>
    
    <div id="status" class="status info">
        <h3>Status: Initializing...</h3>
        <p>Loading Supabase client...</p>
    </div>

    <div>
        <button onclick="testConnection()">Test Connection</button>
        <button onclick="testProducts()">Test Products Table</button>
        <button onclick="testInsert()">Test Insert Product</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results"></div>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="backend/config.js"></script>
    <script src="backend/api.js"></script>
    <script src="backend/init.js"></script>

    <script>
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');

        // Update status on load
        setTimeout(() => {
            if (typeof API !== 'undefined') {
                statusDiv.className = 'status success';
                statusDiv.innerHTML = `
                    <h3>‚úÖ Status: Connected</h3>
                    <p>Supabase URL: ${SUPABASE_CONFIG.url}</p>
                    <p>API initialized successfully!</p>
                `;
            } else {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    <h3>‚ùå Status: Failed</h3>
                    <p>Could not initialize API</p>
                `;
            }
        }, 1000);

        async function testConnection() {
            addResult('Testing database connection...', 'info');
            try {
                const { data, error } = await supabaseClient
                    .from('products')
                    .select('count');
                
                if (error) throw error;
                
                addResult('‚úÖ Connection successful!', 'success');
                addResult(JSON.stringify(data, null, 2), 'info');
            } catch (err) {
                addResult('‚ùå Connection failed: ' + err.message, 'error');
            }
        }

        async function testProducts() {
            addResult('Fetching products...', 'info');
            try {
                const products = await API.getAllProducts();
                addResult(`‚úÖ Found ${products.length} products`, 'success');
                addResult(JSON.stringify(products, null, 2), 'info');
            } catch (err) {
                addResult('‚ùå Error: ' + err.message, 'error');
            }
        }

        async function testInsert() {
            addResult('Testing product insert...', 'info');
            try {
                const testProduct = {
                    title: 'Test Product ' + Date.now(),
                    description: 'This is a test product',
                    price: 999,
                    category: 'Test',
                    is_sold_out: false
                };
                
                const result = await API.createProduct(testProduct);
                addResult('‚úÖ Product created successfully!', 'success');
                addResult(JSON.stringify(result, null, 2), 'info');
            } catch (err) {
                addResult('‚ùå Error: ' + err.message, 'error');
            }
        }

        function addResult(message, type) {
            const div = document.createElement('div');
            div.className = 'status ' + type;
            if (message.startsWith('{') || message.startsWith('[')) {
                div.innerHTML = '<pre>' + message + '</pre>';
            } else {
                div.innerHTML = '<p>' + message + '</p>';
            }
            resultsDiv.appendChild(div);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }
    </script>
</body>
</html>
